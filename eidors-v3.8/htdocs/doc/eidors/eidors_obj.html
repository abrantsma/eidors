<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of eidors_obj</title>
  <meta name="keywords" content="eidors_obj">
  <meta name="description" content="EIDORS_OBJ: 'constructor' to create a eidors structure">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">eidors</a> &gt; eidors_obj.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for eidors&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>eidors_obj
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>EIDORS_OBJ: 'constructor' to create a eidors structure</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function obj_id= eidors_obj(type,name, varargin ); </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> EIDORS_OBJ: 'constructor' to create a eidors structure
 USAGE: to get eidors_version
     version = eidors_obj('eidors_version')

 USAGE: as a constructor
     obj  = eidors_obj(type,name,prop1,value1, prop1, value2, ...)

     type:  obj type: fwd_model, inv_model, data, image
     name:  text string identifier for model (may be '')
     prop1, value1, etc: properites and values for object

    example: fwd_mdl = ...
        eidors_obj('fwd_model','My FWD MODEL', ...
                    'nodes', NODES, 'elems', ELEMS, ...

 OR construct from structure
     obj  = eidors_obj(type,obj);

     example: fwd_mdl.nodes = NODES; .... %etc
              fwd_mdl = eidors_obj('fwd_model',fwd_mdl);

 All constructors will set the appropriate default
   values for each type: image, fwd_model, inv_model, data

 USAGE: to set values
     obj  = eidors_obj('set',obj,prop1,value1, prop1, value2, ...)

 this will set the values of properties of the object. At the
 same time, any cached values will be erased (because they may
 depend on older properties of the model)
   
    example:
        eidors_obj('set',fwd_mdl, 'nodes', NEW_NODES);

 USAGE: to cache values
          eidors_obj('set-cache',obj, cachename,value1, dep_objs, ...)
     obj= eidors_obj('get-cache',obj, cachename, dep_objs, ...)

 this will get or set the values of cached properties of the object.

    example: % set jacobian
        eidors_obj('set-cache',fwd_mdl, 'jacobian', J):

    example: % get jacobian or '[]' if not set
        J= eidors_obj('get-cache',fwd_mdl, 'jacobian'):

 However, in some cases, such as the Jacobian, the value depends
 on other objects, such as the image background. In this case, use

    example: % set jacobian
        eidors_obj('set-cache',fwd_mdl, 'jacobian', J, homg_img):

    example: % get jacobian or '[]' if not set
        J= eidors_obj('get-cache',fwd_mdl, 'jacobian', homg_img):</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="../eidors/tools/eidors_cache.html" class="code" title="function varargout=eidors_cache( command, varargin )">eidors_cache</a>	EIDORS_CACHE Control eidors caching</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="../eidors/algorithms/left_divide.html" class="code" title="function [V] = left_divide(E,I,tol,pp,V)">left_divide</a>	[V] = left_divide(E,I,tol,pp,V);</li><li><a href="../eidors/deprecated/ab_tv_diff_solve.html" class="code" title="function img= ab_tv_diff_solve( inv_model, data1, data2)">ab_tv_diff_solve</a>	AB_TV_DIFF_SOLVE inverse solver for Andrea Borsic's</li><li><a href="../eidors/deprecated/edge_refined_elem_mapper.html" class="code" title="function [index_simp]=edge_refined_elem_mapper( mdl_coarse, mdl_dense)">edge_refined_elem_mapper</a>	EDGE_REFINED_ELEM_MAPPER: map elements from coarse to dense model</li><li><a href="../eidors/deprecated/edge_refined_node_mapper.html" class="code" title="function [index_vtx] = edge_refined_node_mapper(mdl_coarse, mdl_dense);">edge_refined_node_mapper</a>	EDGE_REFINED_NODE_MAPPER:</li><li><a href="../eidors/deprecated/fem_master_full.html" class="code" title="function [E,D,Ela,pp] = fem_master_full(vtx,simp,mat,gnd_ind,elec,zc,perm_sym);">fem_master_full</a>	function [E,D,Ela,pp] = fem_master_full(vtx,simp,mat,gnd_ind,elec,zc,perm_sym);</li><li><a href="../eidors/deprecated/forward_solver.html" class="code" title="function [V] = forward_solver(E,I,tol,pp,V, compat_param);">forward_solver</a>	[V] = forward_solver(E,I,tol,pp,V);</li><li><a href="../eidors/deprecated/image_levels.html" class="code" title="function image_levels(img, levels, clim )">image_levels</a>	IMAGE_LEVELS(img, levels, clim  ) show slices at levels of an image</li><li><a href="../eidors/deprecated/inv_solve_dual_mesh.html" class="code" title="function img= inv_solve_dual_mesh( inv_model, voltage)">inv_solve_dual_mesh</a>	INV_SOLVE_DUAL_MESH using a coarse and fine mesh</li><li><a href="../eidors/deprecated/m_3d_fields.html" class="code" title="function [v_f] = m_3d_fields(vtx,el_no,m_ind,E,tol,gnd_ind,v_f);">m_3d_fields</a>	function [v_f] = m_3d_fields(vtx,el_no,m_ind,E,tol,gnd_ind,v_f);</li><li><a href="../eidors/deprecated/manchester_tomography.html" class="code" title="function manchester_tomography( example_no)">manchester_tomography</a>	Example to show reconstructions from</li><li><a href="../eidors/deprecated/np_calc_3d_fields.html" class="code" title="function v_f= np_calc_3d_fields( fwd_model, img)">np_calc_3d_fields</a>	NP_CALC_3D_FIELDS: J= np_calc_3d_fields( fwd_model, img)</li><li><a href="../eidors/deprecated/np_calc_image_prior.html" class="code" title="function Reg= np_calc_image_prior( inv_model );">np_calc_image_prior</a>	NP_CALC_IMAGE_PRIOR calculate image prior</li><li><a href="../eidors/deprecated/np_calc_system_mat.html" class="code" title="function s_mat= np_calc_system_mat( fwd_model, img)">np_calc_system_mat</a>	NP_CALC_SYSTEM_MAT: s_mat= np_calc_system_mat( fwd_model, img)</li><li><a href="../eidors/deprecated/np_fwd_parameters.html" class="code" title="function param = np_fwd_parameters( fwd_model )">np_fwd_parameters</a>	NP_FWD_PARAMETERS: data= np_fwd_solve( fwd_model )</li><li><a href="../eidors/deprecated/np_inv_solve.html" class="code" title="function img= np_inv_solve( inv_model, data1, data2)">np_inv_solve</a>	NP_INV_SOLVE inverse solver for Nick Polydorides EIDORS3D code</li><li><a href="../eidors/deprecated/set_fwd_model.html" class="code" title="function [fwd_mdl]=set_fwd_model(vtx,simp,srf,elec,zc,gnd_ind,Ib,indH,df,perm_sym);">set_fwd_model</a>	SET_FWD_MODEL: create EIDORS v3 fwd_model from v2 parameters</li><li><a href="eidors_msg.html" class="code" title="function log_level= eidors_msg( message, varargin )">eidors_msg</a>	EIDORS_MSG eidors progress and status messages</li><li><a href="eidors_startup.html" class="code" title="function eidors_startup( path_array )">eidors_startup</a>	Script to start EIDORS</li><li><a href="../eidors/examples/cheating_2d.html" class="code" title="function out=cheating_2d( figno, rand_seed )">cheating_2d</a>	code to simulate inverse crimes in EIT</li><li><a href="../eidors/examples/compare_2d_algs.html" class="code" title="function [imgr, img]= compare_2d_algs(option,shape);">compare_2d_algs</a>	Compare different 2D reconstructions</li><li><a href="../eidors/examples/compare_3d_algs.html" class="code" title="function imgr= compare_3d_algs( algno )">compare_3d_algs</a>	Compare different 3D reconstructions</li><li><a href="../eidors/examples/demo_2d_simdata.html" class="code" title="">demo_2d_simdata</a>	Example of using EIDORS to simulate 2D data and to</li><li><a href="../eidors/examples/demo_3d_simdata.html" class="code" title="">demo_3d_simdata</a>	How to make simulation data using EIDORS3D</li><li><a href="../eidors/examples/demo_real.html" class="code" title="function [inhomg_img, demo_img] = demo_real;">demo_real</a>	[inhomg_img, demo_img] = demo_real;</li><li><a href="../eidors/examples/resistor_model.html" class="code" title="function resistor_model;">resistor_model</a>	DEMO to show really simple application of EIDORS framework</li><li><a href="../eidors/graphics/matlab/calc_colours.html" class="code" title="function [colours,scl_data]= calc_colours(img, set_value, do_colourbar)">calc_colours</a>	[colours,scl_data]= calc_colours(img, set_value, do_colourbar)</li><li><a href="../eidors/graphics/matlab/show_fem.html" class="code" title="function hh=show_fem( mdl, options)">show_fem</a>	SHOW_FEM: show the EIDORS3D finite element model</li><li><a href="../eidors/graphics/matlab/show_fem_enhanced.html" class="code" title="function hh = show_fem(mdl, options)">show_fem_enhanced</a>	SHOW_FEM: show the EIDORS3D finite element model</li><li><a href="../eidors/graphics/matlab/show_fem_move.html" class="code" title="function [hf,hh] = show_fem_move( img, move, scale, options )">show_fem_move</a>	SHOW_FEM_MOVE   Plot EIT finite element model (FEM) and movement</li><li><a href="../eidors/meshing/calc_mesh_quality.html" class="code" title="function [Q mdl] = calc_mesh_quality(mdl, show)">calc_mesh_quality</a>	CALC_MESH_QUALITY Various measures of mesh quality.</li><li><a href="../eidors/meshing/distmesh/dm_2d_circ_pt_elecs.html" class="code" title="function fmdl = dm_2d_circ_pt_elecs( elec_pts, pfix, spacing);">dm_2d_circ_pt_elecs</a>	DM_2D_CIRC_PT_ELECS: Create circle mesh (or radius 1) refined with electrodes</li><li><a href="../eidors/meshing/distmesh/dm_mk_fwd_model.html" class="code" title="function [fwd_mdl]= dm_mk_fwd_model( fd, fh, nnodes, bbox, elec_nodes,refine_nodes, z_contact, name)">dm_mk_fwd_model</a>	DM_MK_FWD_MODEL: create a fwd_model object using distmesh</li><li><a href="../eidors/meshing/gmsh/create_circle_mesh_gmsh.html" class="code" title="function mdl = create_circle_mesh_gmsh(basename, center, rad, elem_size )">create_circle_mesh_gmsh</a>	Create a 2D Circular FEM using GMSH</li><li><a href="../eidors/meshing/gmsh/gmsh_mk_fwd_model.html" class="code" title="function [fwd_mdl, mat_indices]=gmsh_mk_fwd_model( vol_filename, name, eprefix,stim_pattern, z_contact)">gmsh_mk_fwd_model</a>	GMSH_MK_FWD_MODEL: create a fwd_model object from a Gmsh file</li><li><a href="../eidors/meshing/netgen/mdl2d_from3d.html" class="code" title="function mdl2 = mdl2d_from3d(mdl3);">mdl2d_from3d</a>	mdl2d_from3d: Create 2D mdl from z=0 plane of 3d model</li><li><a href="../eidors/meshing/netgen/ng_mk_cyl_models.html" class="code" title="function [fmdl,mat_idx] = ng_mk_cyl_models(cyl_shape, elec_pos,elec_shape, extra_ng_code);">ng_mk_cyl_models</a>	NG_MAKE_CYL_MODELS: create cylindrical models using netgen</li><li><a href="../eidors/meshing/netgen/ng_mk_ellip_models.html" class="code" title="function [fmdl,mat_idx] = ng_mk_ellip_models(ellip_shape, elec_pos,elec_shape, extra_ng_code);">ng_mk_ellip_models</a>	NG_MAKE_ELLIP_MODELS: create elliptical models using netgen</li><li><a href="../eidors/meshing/netgen/ng_mk_extruded_model.html" class="code" title="function [fmdl,mat_idx] = ng_mk_extruded_model(shape, elec_pos, elec_shape,extra_ng_code)">ng_mk_extruded_model</a>	NG_MAKE_EXTRUDED_MODEL: create extruded models using netgen</li><li><a href="../eidors/meshing/netgen/ng_mk_fwd_model.html" class="code" title="function [fwd_mdl, mat_idx_reordered]=ng_mk_fwd_model( ng_vol_filename, centres,name, stim_pattern, z_contact, postprocmesh)">ng_mk_fwd_model</a>	NG_MK_FWD_MODEL: create a fwd_model object from a netgen vol file</li><li><a href="../eidors/meshing/netgen/ng_mk_gen_models.html" class="code" title="function [fmdl,mat_idx] = ng_mk_gen_models(shape_str, elec_pos,  elec_shape, elec_obj, extra_ng_code);">ng_mk_gen_models</a>	NG_MK_GEN_MODELS: create generic models using netgen</li><li><a href="../eidors/meshing/netgen/ng_mk_geometric_models.html" class="code" title="function [fmdl, mat_idx] = ng_mk_geometric_models(body_geometry, electrode_geometry)">ng_mk_geometric_models</a>	NG_MK_GEOMETRIC_MODELS: create geometric mesh models using Netgen. Body</li><li><a href="../eidors/models/add_noise.html" class="code" title="function vv = add_noise( SNR, v1, v2, options)">add_noise</a>	ADD_NOISE: Add a given SNR to EIDORS data</li><li><a href="../eidors/models/create_inclusion.html" class="code" title="function inhomg_img = create_inclusion( homg_img, center, r, inclusion_mat, order)">create_inclusion</a>	USAGE: inhomg_img = create_inclusion( homg_img, inclusion_xyz, ...</li><li><a href="../eidors/models/data_mapper.html" class="code" title="function img = data_mapper(img, reverse)">data_mapper</a>	DATA_MAPPER maps img.params data to elem or node data</li><li><a href="../eidors/models/fix_model.html" class="code" title="function [mdl] = fix_model(mdl,opt)">fix_model</a>	FIX_MODEL: Add useful fields to a model</li><li><a href="../eidors/models/get_elem_volume.html" class="code" title="function VOL = get_elem_volume( fwd_model, map_node )">get_elem_volume</a>	GET_ELEM_VOLUME: VOL = get_elem_volume(fwd_model, map_node )</li><li><a href="../eidors/models/interp_mesh.html" class="code" title="function mdl_pts = interp_mesh( mdl, n_interp)">interp_mesh</a>	INTERP_MESH: calculate interpolation points onto mdl elements</li><li><a href="../eidors/models/mk_c2f_circ_mapping.html" class="code" title="function [mapping failed] = mk_c2f_circ_mapping( mdl, xyzr );">mk_c2f_circ_mapping</a>	MK_C2F_CIRC_MAPPING: create a mapping matrix from circles/spheres to FEM</li><li><a href="../eidors/models/mk_common_gridmdl.html" class="code" title="function inv_mdl= mk_common_gridmdl( str, RM)">mk_common_gridmdl</a>	MK_COMMON_MODEL: make EIT on reconstruction grids (GREIT)</li><li><a href="../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>	MK_COMMON_MODEL: make common EIT models</li><li><a href="../eidors/models/mk_fmdl_from_nodes.html" class="code" title="function mdl= mk_fmdl_from_nodes( vtx, elec_nodes, z_contact, name)">mk_fmdl_from_nodes</a>	MK_FMDL_FROM_NODES: create fmdl from nodes</li><li><a href="../eidors/models/mk_grid_model.html" class="code" title="function [cmdl, c2f]= mk_grid_model(fmdl, xvec, yvec, zvec);">mk_grid_model</a>	MK_GRID_MODEL: Create reconstruction model on pixelated grid</li><li><a href="../eidors/models/mk_image.html" class="code" title="function img= mk_image(mdl, elem_data, params, name)">mk_image</a>	MK_IMAGE: create eidors image object</li><li><a href="../eidors/models/mk_library_model.html" class="code" title="function out = mk_library_model(shape,elec_pos,elec_shape,maxsz,nfft,scale)">mk_library_model</a>	MK_LIBRARY_MODEL - FEM models based on library shapes</li><li><a href="../eidors/models/simulate_2d_movement.html" class="code" title="function [vh,vi,xyr_pt]= simulate_2d_movement( n_sims, fmdl, rad_pr, movefcn )">simulate_2d_movement</a>	SIMULATE_2D_MOVEMENT simulate rotational movement in 2D</li><li><a href="../eidors/models/simulate_3d_movement.html" class="code" title="function [vh,vi,xyzr_pt]= simulate_3d_movement( n_sims, fmdl, rad_pr,movefcn )">simulate_3d_movement</a>	SIMULATE_3D_MOVEMENT simulate rotational movement in 3D</li><li><a href="../eidors/solvers/calc_R_prior.html" class="code" title="function R_prior = calc_R_prior( inv_model, varargin )">calc_R_prior</a>	R = calc_R_prior( inv_model, varargin )</li><li><a href="../eidors/solvers/calc_jacobian_bkgnd.html" class="code" title="function img_bkgnd = calc_jacobian_bkgnd( inv_model )">calc_jacobian_bkgnd</a>	CALC_JACOBIAN_BKGND: calculate background image around</li><li><a href="../eidors/solvers/calc_meas_icov.html" class="code" title="function meas_icov = calc_meas_icov( inv_model )">calc_meas_icov</a>	meas_icov = calc_meas_icov( inv_model )</li><li><a href="../eidors/solvers/fwd_solve.html" class="code" title="function data = fwd_solve(fwd_model, img)">fwd_solve</a>	FWD_SOLVE: calculate data from a fwd_model object and an image</li><li><a href="../eidors/solvers/inv_solve.html" class="code" title="function img = inv_solve( inv_model, data1, data2)">inv_solve</a>	INV_SOLVE: calculate imag from an inv_model and data</li><li><a href="../eidors/solvers/inverse/calc_TSVD_RM.html" class="code" title="function RM= calc_TSVD_RM(mdl,hp)">calc_TSVD_RM</a>	CALC_TSVD_RM: Calculated truncated Jacobian SVD reconstruction matrix</li><li><a href="../eidors/solvers/inverse/calc_noise_figure.html" class="code" title="function [NF,SE] = calc_noise_figure( inv_model, hp, iterations)">calc_noise_figure</a>	CALC_NOISE_FIGURE: calculate the noise amplification (NF) of an algorithm</li><li><a href="../eidors/solvers/inverse/inv_solve_TV_pdipm.html" class="code" title="function img= inv_solve_TV_pdipm( inv_model, data1, data2)">inv_solve_TV_pdipm</a>	INV_SOLVE_TV_PDIPM inverse solver for Andrea Borsic's</li><li><a href="../eidors/solvers/inverse/inv_solve_abs_annealingMetropolis_params.html" class="code" title="function [img]= inv_solve_abs_annealingMetropolis_params(inv_model, data)">inv_solve_abs_annealingMetropolis_params</a>	INV_SOLVE_ABS_ANNEALINGSIMPLEX_PARAMS absolute solver using the simplex annealing method.</li><li><a href="../eidors/solvers/inverse/inv_solve_abs_annealingSimplex_params.html" class="code" title="function [img]= inv_solve_abs_annealingSimplex_params(inv_model, data)">inv_solve_abs_annealingSimplex_params</a>	INV_SOLVE_ABS_ANNEALINGSIMPLEX_PARAMS absolute solver using the simplex annealing method.</li><li><a href="../eidors/solvers/inverse/inv_solve_abs_core.html" class="code" title="function img= inv_solve_abs_core( inv_model, data0);">inv_solve_abs_core</a>	INV_SOLVE_ABS_CORE Absolute solver using a generic iterative algorithm</li><li><a href="../eidors/solvers/inverse/inv_solve_backproj.html" class="code" title="function img= inv_solve_backproj( inv_model, data1, data2)">inv_solve_backproj</a>	INV_SOLVE_BACKPROJ inverse solver using backprojection</li><li><a href="../eidors/solvers/inverse/primaldual_tvrecon_lsearch.html" class="code" title="function [rs,x]=primaldual_tvrecon_lsearch(inv_mdl, vmeas,maxiter,alpha1,alpha2, epsilon, beta, min_change)">primaldual_tvrecon_lsearch</a>	[rs,x]=primaldual_tvrecon_lsearch(inv_mdl, vmeas, ...</li><li><a href="../eidors/tests/cache_limit_test.html" class="code" title="function cache_limit_test">cache_limit_test</a>	Test cache deletes in the right order</li><li><a href="../eidors/tests/calc_data_prior_test.html" class="code" title="function ok= calc_data_prior_test">calc_data_prior_test</a>	Verify dataprior:</li><li><a href="../eidors/tests/calc_jacobian_test.html" class="code" title="function ok= calc_jacobian_test">calc_jacobian_test</a>	Verify Jacobian Calculation by small derivative from forward problem</li><li><a href="../eidors/tests/demo_real_test2.html" class="code" title="function ok= demo_real_test2">demo_real_test2</a>	Perform tests based on the demo_real function with new structs</li><li><a href="../eidors/tests/demo_real_test3.html" class="code" title="function ok= demo_real_test3">demo_real_test3</a>	Perform tests based on the demo_real function with new structs</li><li><a href="../eidors/tests/test_2d_resistor.html" class="code" title="function test_2d_resistor(opt)">test_2d_resistor</a>	Create 2D model of a cylindrical resistor</li><li><a href="../eidors/tests/test_3d_resistor.html" class="code" title="">test_3d_resistor</a>	Create 3D model of a Rectangular resistor</li><li><a href="../eidors/tests/test_c2f_jacobian.html" class="code" title="function test_c2f_jacobian">test_c2f_jacobian</a>	Test calc of jacobian given coarse to fine mapping</li><li><a href="../eidors/tests/test_colour_direction.html" class="code" title="">test_colour_direction</a>	Test colour mapping</li><li><a href="../eidors/tools/eidors_cache.html" class="code" title="function varargout=eidors_cache( command, varargin )">eidors_cache</a>	EIDORS_CACHE Control eidors caching</li><li><a href="../eidors/tools/test_performance.html" class="code" title="function [r, params] =  test_performance( imdls, fmdl );">test_performance</a>	TEST_PERFORMANCE: test of difference reconstruction algorithms</li><li><a href="../eidors/tools/test_performance_img.html" class="code" title="function [params_img] =  test_performance_img( imdls, fmdl );">test_performance_img</a>	TEST_PERFORMANCE: test of difference reconstruction algorithms</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function ok = status_check(name)</a></li><li><a href="#_sub2" class="code">function on = debug_status_check</a></li><li><a href="#_sub3" class="code">function out = cache_status(fname)</a></li><li><a href="#_sub4" class="code">function out = debug_status(fname)</a></li><li><a href="#_sub5" class="code">function test_install</a></li><li><a href="#_sub6" class="code">function verstr = test_versions;</a></li><li><a href="#_sub7" class="code">function obj = set_obj( obj, varargin );</a></li><li><a href="#_sub8" class="code">function value= get_cache_obj( obj, prop, varargin );</a></li><li><a href="#_sub9" class="code">function set_cache_obj( obj, prop, value, varargin )</a></li><li><a href="#_sub10" class="code">function obj= new_obj( type, name, varargin );</a></li><li><a href="#_sub11" class="code">function obj_id= calc_obj_id( var )</a></li><li><a href="#_sub12" class="code">function test_for_cachdir</a></li><li><a href="#_sub13" class="code">function [objlist, cachedir]= proc_obj_list( varargin );</a></li><li><a href="#_sub14" class="code">function retval= cache_this( obj )</a></li><li><a href="#_sub15" class="code">function update_timestamp_and_check_size( obj_id )</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function obj_id= eidors_obj(type,name, varargin );</a>
0002 <span class="comment">% EIDORS_OBJ: 'constructor' to create a eidors structure</span>
0003 <span class="comment">% USAGE: to get eidors_version</span>
0004 <span class="comment">%     version = eidors_obj('eidors_version')</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% USAGE: as a constructor</span>
0007 <span class="comment">%     obj  = eidors_obj(type,name,prop1,value1, prop1, value2, ...)</span>
0008 <span class="comment">%</span>
0009 <span class="comment">%     type:  obj type: fwd_model, inv_model, data, image</span>
0010 <span class="comment">%     name:  text string identifier for model (may be '')</span>
0011 <span class="comment">%     prop1, value1, etc: properites and values for object</span>
0012 <span class="comment">%</span>
0013 <span class="comment">%    example: fwd_mdl = ...</span>
0014 <span class="comment">%        eidors_obj('fwd_model','My FWD MODEL', ...</span>
0015 <span class="comment">%                    'nodes', NODES, 'elems', ELEMS, ...</span>
0016 <span class="comment">%</span>
0017 <span class="comment">% OR construct from structure</span>
0018 <span class="comment">%     obj  = eidors_obj(type,obj);</span>
0019 <span class="comment">%</span>
0020 <span class="comment">%     example: fwd_mdl.nodes = NODES; .... %etc</span>
0021 <span class="comment">%              fwd_mdl = eidors_obj('fwd_model',fwd_mdl);</span>
0022 <span class="comment">%</span>
0023 <span class="comment">% All constructors will set the appropriate default</span>
0024 <span class="comment">%   values for each type: image, fwd_model, inv_model, data</span>
0025 <span class="comment">%</span>
0026 <span class="comment">% USAGE: to set values</span>
0027 <span class="comment">%     obj  = eidors_obj('set',obj,prop1,value1, prop1, value2, ...)</span>
0028 <span class="comment">%</span>
0029 <span class="comment">% this will set the values of properties of the object. At the</span>
0030 <span class="comment">% same time, any cached values will be erased (because they may</span>
0031 <span class="comment">% depend on older properties of the model)</span>
0032 <span class="comment">%</span>
0033 <span class="comment">%    example:</span>
0034 <span class="comment">%        eidors_obj('set',fwd_mdl, 'nodes', NEW_NODES);</span>
0035 <span class="comment">%</span>
0036 <span class="comment">% USAGE: to cache values</span>
0037 <span class="comment">%          eidors_obj('set-cache',obj, cachename,value1, dep_objs, ...)</span>
0038 <span class="comment">%     obj= eidors_obj('get-cache',obj, cachename, dep_objs, ...)</span>
0039 <span class="comment">%</span>
0040 <span class="comment">% this will get or set the values of cached properties of the object.</span>
0041 <span class="comment">%</span>
0042 <span class="comment">%    example: % set jacobian</span>
0043 <span class="comment">%        eidors_obj('set-cache',fwd_mdl, 'jacobian', J):</span>
0044 <span class="comment">%</span>
0045 <span class="comment">%    example: % get jacobian or '[]' if not set</span>
0046 <span class="comment">%        J= eidors_obj('get-cache',fwd_mdl, 'jacobian'):</span>
0047 <span class="comment">%</span>
0048 <span class="comment">% However, in some cases, such as the Jacobian, the value depends</span>
0049 <span class="comment">% on other objects, such as the image background. In this case, use</span>
0050 <span class="comment">%</span>
0051 <span class="comment">%    example: % set jacobian</span>
0052 <span class="comment">%        eidors_obj('set-cache',fwd_mdl, 'jacobian', J, homg_img):</span>
0053 <span class="comment">%</span>
0054 <span class="comment">%    example: % get jacobian or '[]' if not set</span>
0055 <span class="comment">%        J= eidors_obj('get-cache',fwd_mdl, 'jacobian', homg_img):</span>
0056  
0057 
0058 <span class="comment">% (C) 2005-10 Andy Adler. License: GPL version 2 or version 3</span>
0059 <span class="comment">% $Id: eidors_obj.m 4985 2015-05-11 20:03:36Z aadler $</span>
0060 
0061 <span class="keyword">if</span> nargin==0 || ~ischar(type)
0062    error(<span class="string">'cannot call eidors_obj with no arguments'</span>);
0063 <span class="keyword">end</span>
0064 
0065 <span class="keyword">switch</span> type
0066    <span class="keyword">case</span> <span class="string">'set'</span>
0067       obj_id= <a href="#_sub7" class="code" title="subfunction obj = set_obj( obj, varargin );">set_obj</a>( name, varargin{:} );
0068    <span class="keyword">case</span> <span class="string">'get-cache'</span>
0069       <a href="#_sub5" class="code" title="subfunction test_install">test_install</a>
0070       obj_id = [];
0071       <span class="keyword">if</span> <a href="#_sub1" class="code" title="subfunction ok = status_check(name)">status_check</a>(varargin{1})
0072         obj_id= <a href="#_sub8" class="code" title="subfunction value= get_cache_obj( obj, prop, varargin );">get_cache_obj</a>( name, varargin{:} );
0073       <span class="keyword">end</span>
0074       
0075    <span class="keyword">case</span> <span class="string">'set-cache'</span>
0076       <a href="#_sub5" class="code" title="subfunction test_install">test_install</a>
0077       obj_id= [];
0078       <span class="keyword">if</span> <a href="#_sub1" class="code" title="subfunction ok = status_check(name)">status_check</a>(varargin{1})
0079           <a href="#_sub9" class="code" title="subfunction set_cache_obj( obj, prop, value, varargin )">set_cache_obj</a>( name, varargin{:} );
0080       <span class="keyword">end</span>
0081 
0082    <span class="keyword">case</span> <span class="string">'eidors_version'</span>
0083       obj_id= <span class="string">'3.8'</span>;  <span class="comment">% Update for New eidors version</span>
0084       
0085    <span class="keyword">case</span> <span class="string">'eidors_path'</span>
0086       <span class="keyword">global</span> eidors_objects
0087       obj_id = eidors_objects.eidors_path;
0088 
0089    <span class="keyword">case</span> <span class="string">'interpreter_version'</span>
0090       obj_id= test_versions;
0091 <span class="comment">% TODO: Add these functions</span>
0092 <span class="comment">%  case 'eidors_path'</span>
0093 <span class="comment">%  case 'eidors_dev_path'</span>
0094 <span class="comment">%  case 'eidors_cache_path'</span>
0095    <span class="keyword">otherwise</span>
0096       <a href="#_sub5" class="code" title="subfunction test_install">test_install</a>
0097       obj_id= <a href="#_sub10" class="code" title="subfunction obj= new_obj( type, name, varargin );">new_obj</a>( type, name, varargin{:} );
0098 <span class="keyword">end</span>
0099 
0100 <a name="_sub1" href="#_subfunctions" class="code">function ok = status_check(name)</a>
0101 ok = true;
0102 <span class="keyword">switch</span> <a href="#_sub3" class="code" title="subfunction out = cache_status(fname)">cache_status</a>
0103     <span class="keyword">case</span> 0
0104         ok = false;
0105     <span class="keyword">case</span> 0.5
0106         dbs = dbstack;
0107         <span class="keyword">if</span> <a href="#_sub3" class="code" title="subfunction out = cache_status(fname)">cache_status</a>(dbs(3).name) == 0
0108             ok = false;
0109         <span class="keyword">end</span>
0110         <span class="keyword">if</span> strcmp(dbs(3).name,<span class="string">'cache_shorthand'</span>) &amp;&amp; <a href="#_sub3" class="code" title="subfunction out = cache_status(fname)">cache_status</a>(dbs(5).name) == 0
0111             ok = false;
0112         <span class="keyword">end</span>
0113         <span class="keyword">if</span> <a href="#_sub3" class="code" title="subfunction out = cache_status(fname)">cache_status</a>(name) == 0
0114            ok = false;
0115         <span class="keyword">end</span>
0116 <span class="keyword">end</span>
0117 
0118 <a name="_sub2" href="#_subfunctions" class="code">function on = debug_status_check</a>
0119 on = false;
0120 <span class="keyword">switch</span> <a href="#_sub4" class="code" title="subfunction out = debug_status(fname)">debug_status</a>
0121     <span class="keyword">case</span> 1
0122         on = true;
0123     <span class="keyword">case</span> 0.5
0124         dbs = dbstack;
0125         <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction out = debug_status(fname)">debug_status</a>(dbs(3).name) == 1
0126             on = true;
0127         <span class="keyword">end</span>
0128 <span class="keyword">end</span>
0129 
0130 
0131 <a name="_sub3" href="#_subfunctions" class="code">function out = cache_status(fname)</a>
0132     <span class="keyword">global</span> eidors_objects;
0133     <span class="keyword">if</span> nargin == 0
0134         <span class="keyword">try</span>
0135             out = eidors_objects.cache_enable;
0136         <span class="keyword">catch</span>
0137             out = 1;
0138         <span class="keyword">end</span>
0139     <span class="keyword">else</span>
0140         out = ~any(strcmp(eidors_objects.cache_disabled_on,fname));
0141     <span class="keyword">end</span>
0142 
0143     
0144 <a name="_sub4" href="#_subfunctions" class="code">function out = debug_status(fname)   </a>
0145    <span class="keyword">global</span> eidors_objects;
0146    <span class="keyword">if</span> nargin == 0
0147       <span class="keyword">try</span>
0148          out = eidors_objects.debug_enable;
0149       <span class="keyword">catch</span>
0150          out = 0;
0151       <span class="keyword">end</span>
0152    <span class="keyword">else</span>
0153       out = ~any(strcmp(eidors_objects.debug_enabled_on,fname));
0154    <span class="keyword">end</span>
0155       
0156       
0157 <a name="_sub5" href="#_subfunctions" class="code">function test_install</a>
0158   <span class="keyword">global</span> eidors_objects;
0159   <span class="keyword">if</span> isfield(eidors_objects,<span class="string">'max_cache_size'</span>); <span class="keyword">return</span>; <span class="keyword">end</span> <span class="comment">% OK</span>
0160   error(<span class="string">'EIDORS not correctly started. Did you do &quot;&gt;&gt;run /path/to/eidors/startup&quot;'</span>);
0161 
0162 <a name="_sub6" href="#_subfunctions" class="code">function verstr = test_versions;</a>
0163       ver= version; ver(ver==<span class="string">'.'</span>)=<span class="string">' '</span>;
0164       ver = sscanf(ver,<span class="string">'%f'</span>); ver=ver(:);
0165 
0166       <span class="comment">% Convert 7.8.1 to 7.008001</span>
0167       verstr.ver = 1e-3.^(0:length(ver)-1) * ver(:); 
0168 
0169       <span class="keyword">if</span> exist(<span class="string">'OCTAVE_VERSION'</span>) == 5
0170          verstr.isoctave = 1;
0171       <span class="keyword">else</span>
0172          verstr.isoctave = 0;
0173       <span class="keyword">end</span>
0174 
0175       cptr = computer;
0176       <span class="keyword">if</span> strcmp(cptr(end+(-1:0)), <span class="string">'64'</span>)
0177          verstr.is64bit = 1;
0178       <span class="keyword">else</span>
0179          verstr.is64bit = 0;
0180       <span class="keyword">end</span>
0181 
0182 <a name="_sub7" href="#_subfunctions" class="code">function obj = set_obj( obj, varargin );</a>
0183    <span class="keyword">global</span> eidors_objects
0184 
0185 <span class="comment">%  eidors_objects.( obj_id ) = obj;</span>
0186 <span class="comment">%  eidors_objects.( obj_id ).cache= []; %clear cache</span>
0187 <span class="comment">%</span>
0188 
0189    <span class="keyword">for</span> idx= 1:2:nargin-1
0190 <span class="comment">%     obj.( obj_id ).( varargin{idx} )= varargin{idx+1};</span>
0191 <span class="comment">% for matlab 6.1 compatibility</span>
0192       eval(sprintf(<span class="string">'obj.%s=varargin{%d};'</span>, varargin{idx},idx+1 ));
0193    <span class="keyword">end</span>
0194 
0195 <span class="comment">% val= get_cache_obj( obj, prop, dep_obj1, dep_obj2, ...,  cachename );</span>
0196 <a name="_sub8" href="#_subfunctions" class="code">function value= get_cache_obj( obj, prop, varargin );</a>
0197    <span class="keyword">global</span> eidors_objects
0198    value= [];
0199 
0200 <span class="comment">% We don't do this since cache directories aren't defined (yet)</span>
0201 <span class="comment">%  [objlist, cachename]= proc_obj_list( varargin{:} );</span>
0202 
0203    obj_id= <a href="#_sub11" class="code" title="subfunction obj_id= calc_obj_id( var )">calc_obj_id</a>( obj ); <span class="comment">% recalculate in case obj changed</span>
0204 
0205    <span class="keyword">if</span> nargin==3
0206       objlist = varargin;
0207       <span class="keyword">for</span> dep_obj = objlist{:}
0208          prop= [prop,<span class="string">'_'</span>, <a href="#_sub11" class="code" title="subfunction obj_id= calc_obj_id( var )">calc_obj_id</a>(dep_obj)];
0209       <span class="keyword">end</span>
0210    <span class="keyword">end</span>
0211 
0212 <span class="comment">% if cachename is specified, then cache to that file, rather</span>
0213 <span class="comment">%  than to the standard eidors_objects location</span>
0214 <span class="comment">% TODO: fixthis - use ( ) for matlab &gt; 6.0</span>
0215 <span class="comment">%  if ~isempty( cachename )</span>
0216 <span class="comment">%     test_for_cachdir;</span>
0217 <span class="comment">%     filename= [ eidors_objects.cachedir, '/' , prop, '_' cachename '.mat' ];</span>
0218 <span class="comment">%     if exist( filename, 'file')</span>
0219 <span class="comment">%        load(filename); %variable 'value' should be there</span>
0220 <span class="comment">%     end</span>
0221 <span class="comment">%  else</span>
0222       <span class="keyword">try</span>
0223          value= eidors_objects.( obj_id ).cache.( prop );
0224 <span class="comment">%        value= eval(sprintf('eidors_objects.%s.cache.%s;',obj_id,prop));</span>
0225          <a href="#_sub15" class="code" title="subfunction update_timestamp_and_check_size( obj_id )">update_timestamp_and_check_size</a>(obj_id);
0226       <span class="keyword">end</span>
0227 <span class="comment">%  end</span>
0228 
0229 <a name="_sub9" href="#_subfunctions" class="code">function set_cache_obj( obj, prop, value, varargin )</a>
0230    <span class="keyword">global</span> eidors_objects
0231    <span class="keyword">if</span> ~<a href="#_sub14" class="code" title="subfunction retval= cache_this( obj )">cache_this</a>( obj ) ; <span class="keyword">return</span> ; <span class="keyword">end</span>
0232 
0233 <span class="comment">% Cache directories aren't defined, yet</span>
0234 <span class="comment">%  [objlist, cachename]= proc_obj_list( varargin{:} );</span>
0235 
0236    obj_id = <a href="#_sub11" class="code" title="subfunction obj_id= calc_obj_id( var )">calc_obj_id</a>( obj );
0237 
0238    <span class="keyword">if</span> nargin&gt;=4 
0239       objlist = varargin;
0240       <span class="keyword">for</span> dep_obj = objlist{:}
0241          prop= [prop,<span class="string">'_'</span>, <a href="#_sub11" class="code" title="subfunction obj_id= calc_obj_id( var )">calc_obj_id</a>(dep_obj)];
0242       <span class="keyword">end</span>
0243    <span class="keyword">end</span>
0244 
0245 <span class="comment">%  if isempty(cachename)</span>
0246       eidors_objects.( obj_id ).cache.( prop ) = value;
0247       eidors_objects.( obj_id ).priority = eidors_objects.cache_priority;
0248       <a href="#_sub15" class="code" title="subfunction update_timestamp_and_check_size( obj_id )">update_timestamp_and_check_size</a>(obj_id);
0249 <span class="comment">%  else</span>
0250 <span class="comment">%     filename= [ eidors_objects.cachedir, '/' , prop, '_' cachename '.mat' ];</span>
0251 <span class="comment">%     save(filename, 'value');</span>
0252 <span class="comment">%  end</span>
0253 
0254 <a name="_sub10" href="#_subfunctions" class="code">function obj= new_obj( type, name, varargin );</a>
0255    <span class="keyword">global</span> eidors_objects
0256 
0257    <span class="keyword">if</span> isstruct(name)
0258       obj= name;
0259       <span class="keyword">try</span>
0260          name= obj.name;
0261       <span class="keyword">catch</span>
0262          name= <span class="string">'unknown'</span>;
0263       <span class="keyword">end</span>
0264    <span class="keyword">end</span>
0265 
0266    obj.type = type;
0267    obj.name = name;
0268    obj= <a href="#_sub7" class="code" title="subfunction obj = set_obj( obj, varargin );">set_obj</a>(obj, varargin{:} );
0269 
0270 <span class="comment">% This function hashes the value of the variable var</span>
0271 <span class="comment">% to create an obj_id. The goal is to allow proper caching</span>
0272 <span class="comment">% of calculated matrices, by detecting when a previous</span>
0273 <span class="comment">% calculation with same parameters has been made</span>
0274 <a name="_sub11" href="#_subfunctions" class="code">function obj_id= calc_obj_id( var )</a>
0275    <span class="keyword">try</span> 
0276       obj_id= eidors_var_id( var );
0277    <span class="keyword">catch</span>
0278       <span class="keyword">global</span> eidors_objects;
0279       <span class="keyword">if</span> ~isfield(eidors_objects,<span class="string">'hash_type'</span>)
0280          eidors_objects.hash_type= 1e8+1; 
0281       <span class="keyword">end</span>
0282 <span class="comment">%if hashing code is unavailable, then disable caching function</span>
0283       obj_id= sprintf(<span class="string">'id_%08d'</span>, eidors_objects.hash_type );
0284       eidors_objects.hash_type= eidors_objects.hash_type + 1;
0285    <span class="keyword">end</span>
0286 
0287 <span class="comment">% Test whether the cachedir field has been set. This is</span>
0288 <span class="comment">%  where eidors will store cached calculations. If it has</span>
0289 <span class="comment">%  not been set, then create it as 'eidors_cache' in the</span>
0290 <span class="comment">%  current directory</span>
0291 <span class="comment">%</span>
0292 <span class="comment">% NOTE: This code is not (yet) used</span>
0293 <a name="_sub12" href="#_subfunctions" class="code">function test_for_cachdir</a>
0294    <span class="keyword">global</span> eidors_objects; 
0295    <span class="keyword">if</span> ~isfield(eidors_objects, <span class="string">'cachedir'</span>)
0296       cachedir= <span class="string">'eidors_cache'</span>;
0297       eidors_objects.cachedir= [pwd,<span class="string">'/'</span>,cachedir];
0298 
0299       <span class="keyword">if</span> ~exist( eidors_objects.cachedir, <span class="string">'dir'</span>)
0300 <span class="comment">% Now we need to ensure that cachedir exists. Because the</span>
0301 <span class="comment">% STUPID!!! matlab has a completely useless and nonstandard</span>
0302 <span class="comment">% mkdir function, we try this</span>
0303          mkdir(pwd,cachedir); 
0304       <span class="keyword">end</span>
0305    <span class="keyword">end</span>
0306 
0307 <span class="comment">% Test whether a cachedir function has been provided</span>
0308 <span class="comment">% (by testing whether the last entry is a string). If so,</span>
0309 <span class="comment">% return it in objlist, otherwise return []</span>
0310 <a name="_sub13" href="#_subfunctions" class="code">function [objlist, cachedir]= proc_obj_list( varargin );</a>
0311    cachedir= [];
0312    <span class="keyword">if</span> nargin==0
0313       objlist= {};
0314    <span class="keyword">elseif</span> ischar(varargin{nargin})
0315       cachedir= varargin{nargin};
0316       objlist = varargin(1:nargin-1);
0317    <span class="keyword">else</span>
0318       objlist = varargin(:);
0319    <span class="keyword">end</span>
0320 
0321 <a name="_sub14" href="#_subfunctions" class="code">function retval= cache_this( obj )</a>
0322 <span class="comment">% we choose not to cache data and images because this will</span>
0323 <span class="comment">% tend to fill up the workspace.</span>
0324 <span class="comment">% TODO: make the DONT_CACHE list use configuable</span>
0325    <span class="keyword">if</span> ~isstruct( obj); retval=1; <span class="keyword">return</span>; <span class="keyword">end</span>
0326    DONT_CACHE= {<span class="string">'data'</span>,<span class="string">'image'</span>};
0327    <span class="keyword">if</span> any(strcmp( obj.type, DONT_CACHE));
0328       retval = 0;
0329    <span class="keyword">else</span>
0330       retval = 1;
0331    <span class="keyword">end</span>
0332 
0333 <a name="_sub15" href="#_subfunctions" class="code">function update_timestamp_and_check_size( obj_id )</a>
0334    <span class="keyword">global</span> eidors_objects;
0335 
0336    eidors_objects.( obj_id ).last_used = now;
0337 
0338    max_memory= eidors_objects.max_cache_size;
0339    ww= whos(<span class="string">'eidors_objects'</span>);
0340    <span class="keyword">if</span> ww.bytes &gt; max_memory
0341       <a href="../eidors/tools/eidors_cache.html" class="code" title="function varargout=eidors_cache( command, varargin )">eidors_cache</a>(<span class="string">'clear_max'</span>,floor(max_memory*.75));
0342    <span class="keyword">end</span>
0343</pre></div>
<hr><address>Generated on Tue 12-May-2015 16:08:56 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>