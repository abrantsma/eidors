<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of calc_slices</title>
  <meta name="keywords" content="calc_slices">
  <meta name="description" content="calc_slices (img, levels, clim  ) show slices at levels of an">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">eidors</a> &gt; <a href="#">graphics</a> &gt; <a href="index.html">matlab</a> &gt; calc_slices.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for eidors/graphics/matlab&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>calc_slices
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>calc_slices (img, levels, clim  ) show slices at levels of an</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function rimg = calc_slices( img, levels ); </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> calc_slices (img, levels, clim  ) show slices at levels of an
             using a fast rendering algorithm
 img    = EIDORS image struct, or array of I images
 levels = Matrix [Lx3] of L image levels
          each row of the matrix specifies the intercepts
          of the slice on the x, y, z axis. To specify a z=2 plane
          parallel to the x,y: use levels= [inf,inf,2]

 if levels is scalar, then make levels equispaced horizontal
          cuts through the object

 PARAMETERS:
   img.calc_slices.filter % Filter to be applied to images
      Example:    img.calc_slices.filter = ones(3)/9
   img.calc_slices.scale  % Scaling to apply to images
   img.calc_slices.levels % an alternative way to specify levels

 rimg= np x np x I x L where np is 128 by default

   np can be adjusted by calc_colours('npoints')
     or by setting
   img.fwd_model.mdl_slice_mapper.{npx, npy}
        see help of mdl_slice_mapper for more options</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../eidors/eidors_msg.html" class="code" title="function log_level= eidors_msg( message, varargin )">eidors_msg</a>	EIDORS_MSG eidors progress and status messages</li><li><a href="calc_colours.html" class="code" title="function [colours,scl_data]= calc_colours(img, set_value, do_colourbar)">calc_colours</a>	[colours,scl_data]= calc_colours(img, set_value, do_colourbar)</li><li><a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>	calc_slices (img, levels, clim  ) show slices at levels of an</li><li><a href="mdl_slice_mapper.html" class="code" title="function map = mdl_slice_mapper( fmdl, maptype );">mdl_slice_mapper</a>	MDL_SLICE_MAPPER: map pixels to FEM elements or nodes</li><li><a href="../../../eidors/models/data_mapper.html" class="code" title="function img = data_mapper(img, reverse)">data_mapper</a>	DATA_MAPPER maps img.params data to elem or node data</li><li><a href="../../../eidors/models/mdl_dim.html" class="code" title="function num = mdl_dim( mdl );">mdl_dim</a>	MDL_DIM: dimension of model space (are nodes in 2D or 3D space)</li><li><a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>	MK_COMMON_MODEL: make common EIT models</li><li><a href="../../../eidors/models/mk_image.html" class="code" title="function img= mk_image(mdl, elem_data, params, name)">mk_image</a>	MK_IMAGE: create eidors image object</li><li><a href="../../../eidors/solvers/calc_jacobian_bkgnd.html" class="code" title="function img_bkgnd = calc_jacobian_bkgnd( inv_model )">calc_jacobian_bkgnd</a>	CALC_JACOBIAN_BKGND: calculate background image around</li><li><a href="../../../eidors/solvers/get_img_data.html" class="code" title="function [img_data, n_images]= get_img_data(img)">get_img_data</a>	GET_IMG_DATA: get parameter data from eidors image object</li><li><a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>	UNIT_TEST_CMP: compare matrices in eidors output</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../eidors/algorithms/calc_posn_resolution.html" class="code" title="function [br,pos]= calc_posn_resolution( img, fwd_model)">calc_posn_resolution</a>	CALC_POSN_RESOLUTION: calculate posn and resolution of a target</li><li><a href="../../../eidors/algorithms/eval_GREIT_fig_merit.html" class="code" title="function params = eval_GREIT_fig_merit(imgs, xyzr_pt)">eval_GREIT_fig_merit</a>	EVAL_GREIT_FIG_MERIT: calculate GREIT figures of merit for images</li><li><a href="animate_reconstructions.html" class="code" title="function fname_out= animate_reconstructions(fname, imgs);">animate_reconstructions</a>	animate_reconstructions(fname, imgs);</li><li><a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>	calc_slices (img, levels, clim  ) show slices at levels of an</li><li><a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels )">show_slices</a>	out_img = show_slices (img, levels ) show slices at levels of an</li><li><a href="../../../eidors/interface/igt2img.html" class="code" title="function img = igt2img(igt)">igt2img</a>	IGT2IMG constructs an EIDORS IMG struct from an IGT frames-by-912 matrix.</li><li><a href="../../../eidors/interface/img2igt.html" class="code" title="function igt = img2igt(img)">img2igt</a>	IMG2IGT returns an IGT-compatible image matrix from any EIDORS</li><li><a href="../../../eidors/interface/sigmatome2_filter.html" class="code" title="function [Filter, stim_pattern]= sigmatome2_filter(test);">sigmatome2_filter</a>	SIGMATOME2_FILTER:  Hardware filter and stim_patterns for Sigmatome II device</li><li><a href="../../../eidors/models/mk_pixel_slice.html" class="code" title="function [imdl fmdl] = mk_pixel_slice(imdl,level,opt)">mk_pixel_slice</a>	MK_PIXEL_SLICE create a pixel model to reconstruct on</li><li><a href="../../../eidors/tests/test_colour_direction.html" class="code" title="">test_colour_direction</a>	Test colour mapping</li><li><a href="../../../eidors/tools/test_performance.html" class="code" title="function [r, params] =  test_performance( imdls, fmdl );">test_performance</a>	TEST_PERFORMANCE: test of difference reconstruction algorithms</li><li><a href="../../../eidors/tools/test_performance_img.html" class="code" title="function [params_img] =  test_performance_img( imdls, fmdl );">test_performance_img</a>	TEST_PERFORMANCE: test of difference reconstruction algorithms</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function rimg = calc_this_slice( img, levels, np)</a></li><li><a href="#_sub2" class="code">function rimg= calc_image_nearestnodes( node_data, level, fwd_model, np);</a></li><li><a href="#_sub3" class="code">function rimg= calc_image_nodes( node_data, level, fwd_model, np)</a></li><li><a href="#_sub4" class="code">function rimg= calc_image_elems( elem_data, level, fwd_model, np)</a></li><li><a href="#_sub5" class="code">function  rimg = filter_image(rimg, filt);</a></li><li><a href="#_sub6" class="code">function do_unit_test</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function rimg = calc_slices( img, levels );</a>
0002 <span class="comment">% calc_slices (img, levels, clim  ) show slices at levels of an</span>
0003 <span class="comment">%             using a fast rendering algorithm</span>
0004 <span class="comment">% img    = EIDORS image struct, or array of I images</span>
0005 <span class="comment">% levels = Matrix [Lx3] of L image levels</span>
0006 <span class="comment">%          each row of the matrix specifies the intercepts</span>
0007 <span class="comment">%          of the slice on the x, y, z axis. To specify a z=2 plane</span>
0008 <span class="comment">%          parallel to the x,y: use levels= [inf,inf,2]</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% if levels is scalar, then make levels equispaced horizontal</span>
0011 <span class="comment">%          cuts through the object</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% PARAMETERS:</span>
0014 <span class="comment">%   img.calc_slices.filter % Filter to be applied to images</span>
0015 <span class="comment">%      Example:    img.calc_slices.filter = ones(3)/9</span>
0016 <span class="comment">%   img.calc_slices.scale  % Scaling to apply to images</span>
0017 <span class="comment">%   img.calc_slices.levels % an alternative way to specify levels</span>
0018 <span class="comment">%</span>
0019 <span class="comment">% rimg= np x np x I x L where np is 128 by default</span>
0020 <span class="comment">%</span>
0021 <span class="comment">%   np can be adjusted by calc_colours('npoints')</span>
0022 <span class="comment">%     or by setting</span>
0023 <span class="comment">%   img.fwd_model.mdl_slice_mapper.{npx, npy}</span>
0024 <span class="comment">%        see help of mdl_slice_mapper for more options</span>
0025 <span class="comment">%</span>
0026 
0027 <span class="comment">% (C) 2006 Andy Adler. License: GPL version 2 or version 3</span>
0028 <span class="comment">% $Id: calc_slices.m 4633 2014-08-27 12:27:07Z aadler $</span>
0029 
0030 <span class="keyword">if</span> isstr(img) &amp;&amp; strcmp(img,<span class="string">'UNIT_TEST'</span>); <a href="#_sub6" class="code" title="subfunction do_unit_test">do_unit_test</a>; <span class="keyword">return</span>; <span class="keyword">end</span>
0031 
0032 np = <a href="calc_colours.html" class="code" title="function [colours,scl_data]= calc_colours(img, set_value, do_colourbar)">calc_colours</a>(<span class="string">'npoints'</span>);
0033 <span class="keyword">try</span>   np = img(1).calc_colours.npoints;
0034 <span class="keyword">end</span>
0035 
0036 <span class="keyword">if</span> nargin &lt; 2
0037     <span class="keyword">try</span> 
0038         levels = img.calc_slices.levels; 
0039     <span class="keyword">catch</span>
0040         levels = [];
0041     <span class="keyword">end</span>
0042 <span class="keyword">end</span>
0043 
0044 img = <a href="../../../eidors/models/data_mapper.html" class="code" title="function img = data_mapper(img, reverse)">data_mapper</a>(img);
0045 
0046 <span class="comment">% Assume all fwd_models are same dimension (all 3D or 2D no mixed dims)</span>
0047 <span class="keyword">if</span> <a href="../../../eidors/models/mdl_dim.html" class="code" title="function num = mdl_dim( mdl );">mdl_dim</a>(img(1))==2 
0048    <span class="keyword">if</span> nargin&gt;1 &amp;&amp; ~isempty(levels);
0049        <span class="keyword">if</span> ~all(levels(1,:) == [inf,inf,0])
0050           warning(<span class="string">'specified levels ignored for 2D FEM'</span>);
0051        <span class="keyword">end</span>
0052    <span class="keyword">end</span>
0053    levels= [Inf,Inf,0];
0054 <span class="keyword">elseif</span> <a href="../../../eidors/models/mdl_dim.html" class="code" title="function num = mdl_dim( mdl );">mdl_dim</a>(img(1))==3 &amp;&amp; isempty(levels)
0055    levels = [Inf Inf mean(img.fwd_model.nodes(:,3))];
0056    <a href="../../../eidors/eidors_msg.html" class="code" title="function log_level= eidors_msg( message, varargin )">eidors_msg</a>(<span class="string">'calc_slices: no levels specified, assuming an xy plane'</span>,2);
0057 <span class="keyword">end</span>
0058 
0059 
0060 rimg = [];
0061 <span class="keyword">for</span> i=1:length(img)
0062    rimg = cat(3, rimg, <a href="#_sub1" class="code" title="subfunction rimg = calc_this_slice( img, levels, np)">calc_this_slice</a>( img(i), levels, np) );
0063 <span class="keyword">end</span>
0064 
0065 <a name="_sub1" href="#_subfunctions" class="code">function rimg = calc_this_slice( img, levels, np)</a>
0066     <span class="comment">% If scalar levels then we just create that many cut planes on z-dimension</span>
0067     fwd_model = img.fwd_model;
0068     <span class="keyword">if</span> size(levels)== [1,1]
0069        zmax= max(fwd_model.nodes(:,3));
0070        zmin= min(fwd_model.nodes(:,3));
0071        levels = linspace(zmin,zmax, levels+2);
0072        levels = levels(2:end-1)'*[Inf,Inf,1];
0073     <span class="keyword">end</span>
0074     num_levs= size(levels,1);
0075     <span class="keyword">if</span> isfield(img,<span class="string">'elem_data'</span>)
0076        [elem_data, n_images] = <a href="../../../eidors/solvers/get_img_data.html" class="code" title="function [img_data, n_images]= get_img_data(img)">get_img_data</a>(img);
0077 
0078        clear rimg;
0079        <span class="keyword">for</span> lev_no = fliplr(1:num_levs)
0080            <span class="comment">% start at max so memory is allocated once</span>
0081           level= levels( lev_no, 1:3 );
0082           rimg(:,:,:,lev_no) = <a href="#_sub4" class="code" title="subfunction rimg= calc_image_elems( elem_data, level, fwd_model, np)">calc_image_elems</a>( elem_data, level, fwd_model, np);
0083        <span class="keyword">end</span>
0084     <span class="keyword">elseif</span> isfield(img,<span class="string">'node_data'</span>)
0085        node_data= [img.node_data];
0086        <span class="keyword">if</span> size(node_data,1)==1; node_data=node_data';<span class="keyword">end</span>
0087        n_images= size(node_data,2);
0088        clear rimg;
0089 
0090        <span class="keyword">for</span> lev_no = fliplr(1:num_levs)
0091           level= levels( lev_no, 1:3 );
0092           rimg(:,:,:,lev_no) = <span class="keyword">...</span>
0093              <a href="#_sub3" class="code" title="subfunction rimg= calc_image_nodes( node_data, level, fwd_model, np)">calc_image_nodes</a>( node_data, level, fwd_model, np);
0094        <span class="keyword">end</span>
0095     <span class="keyword">else</span>
0096        error(<span class="string">'img does not have a data field'</span>);
0097     <span class="keyword">end</span>
0098 
0099     <span class="comment">% FILTER IMAGE</span>
0100     <span class="keyword">try</span>   filt = img.calc_slices.filter; 
0101     <span class="keyword">catch</span> filt = 1; <span class="keyword">end</span>
0102     <span class="keyword">try</span>   scal = img.calc_slices.scale; 
0103     <span class="keyword">catch</span> scal = 1; <span class="keyword">end</span>
0104 
0105     filt = scal * ( filt/sum(filt(:)) );
0106     rimg = <a href="#_sub5" class="code" title="subfunction  rimg = filter_image(rimg, filt);">filter_image</a>(rimg, filt);
0107 
0108 <span class="comment">% Calculate an image by mapping it onto the node_ptr matrix</span>
0109 <span class="comment">% This makes a blocky image to nearest node -&gt; no longer used</span>
0110 <a name="_sub2" href="#_subfunctions" class="code">function rimg= calc_image_nearestnodes( node_data, level, fwd_model, np);</a>
0111    <span class="keyword">if</span> ~isfield(fwd_model,<span class="string">'mdl_slice_mapper'</span>);
0112       fwd_model.mdl_slice_mapper.npx  = np;
0113       fwd_model.mdl_slice_mapper.npy  = np;
0114       fwd_model.mdl_slice_mapper.level= level;
0115    <span class="keyword">end</span>
0116    node_ptr = <a href="mdl_slice_mapper.html" class="code" title="function map = mdl_slice_mapper( fmdl, maptype );">mdl_slice_mapper</a>( fwd_model, <span class="string">'node'</span> );
0117 
0118    backgnd= NaN;
0119    n_images= size(node_data,2);
0120    rval= [backgnd*ones(1,n_images); node_data];
0121    rimg= reshape( rval(node_ptr+1,:), [size(node_ptr), n_images]);
0122 
0123 <span class="comment">% Calculate an image by interpolating it onto the elem_ptr matrix</span>
0124 <a name="_sub3" href="#_subfunctions" class="code">function rimg= calc_image_nodes( node_data, level, fwd_model, np)</a>
0125 
0126    <span class="keyword">if</span> ~isfield(fwd_model,<span class="string">'mdl_slice_mapper'</span>);
0127       fwd_model.mdl_slice_mapper.npx  = np;
0128       fwd_model.mdl_slice_mapper.npy  = np;
0129       fwd_model.mdl_slice_mapper.level= level;
0130    <span class="keyword">end</span>
0131 
0132    nd_interp= <a href="mdl_slice_mapper.html" class="code" title="function map = mdl_slice_mapper( fmdl, maptype );">mdl_slice_mapper</a>( fwd_model, <span class="string">'nodeinterp'</span> );
0133    elem_ptr = <a href="mdl_slice_mapper.html" class="code" title="function map = mdl_slice_mapper( fmdl, maptype );">mdl_slice_mapper</a>( fwd_model, <span class="string">'elem'</span> );
0134    [sx,sy]= size(elem_ptr);
0135 
0136    node_ptr = fwd_model.elems; node_ptr = [0*node_ptr(1,:);node_ptr];
0137    node_ptr = reshape( node_ptr( elem_ptr+1, :), sx, sy, []);
0138 
0139    n_images = size(node_data,2);
0140    rimg= zeros(sx, sy, n_images);
0141    backgnd= NaN;
0142    
0143    <span class="keyword">for</span> ni = 1:n_images
0144      znd = [backgnd;node_data(:,ni)]; <span class="comment">% add NaN for background</span>
0145      rimg(:,:,ni) = sum( znd(node_ptr+1) .* nd_interp, 3); 
0146    <span class="keyword">end</span>
0147 
0148 
0149 <span class="comment">% Calculate an image by mapping it onto the elem_ptr matrix</span>
0150 <a name="_sub4" href="#_subfunctions" class="code">function rimg= calc_image_elems( elem_data, level, fwd_model, np)</a>
0151 
0152    <span class="keyword">if</span> ~isfield(fwd_model,<span class="string">'mdl_slice_mapper'</span>);
0153       fwd_model.mdl_slice_mapper.npx  = np;
0154       fwd_model.mdl_slice_mapper.npy  = np;
0155       fwd_model.mdl_slice_mapper.level= level;
0156       <span class="comment">% grid model sets mdl_slice_mapper.np* but not level</span>
0157    <span class="keyword">elseif</span> ~isfield(fwd_model.mdl_slice_mapper,<span class="string">'level'</span>);
0158       fwd_model.mdl_slice_mapper.level= level;
0159    <span class="keyword">end</span>
0160    elem_ptr = <a href="mdl_slice_mapper.html" class="code" title="function map = mdl_slice_mapper( fmdl, maptype );">mdl_slice_mapper</a>( fwd_model, <span class="string">'elem'</span> );
0161 
0162    backgnd= NaN;
0163    n_images= size(elem_data,2);
0164    rval= backgnd*ones(size(elem_data)+[1,0]);
0165    rval(2:<span class="keyword">end</span>,:) = elem_data;
0166    rimg= reshape( rval(elem_ptr+1,:), [size(elem_ptr), n_images]);
0167 
0168 
0169 <a name="_sub5" href="#_subfunctions" class="code">function  rimg = filter_image(rimg, filt);</a>
0170     
0171    <span class="comment">%%% Total MATLAB BS )(*&amp;#$)(*#&amp;@</span>
0172    <span class="comment">%%% the &amp;&amp; operator used to short circuit. Now it doesn't</span>
0173    <span class="comment">%%% How the (*&amp;)(*&amp; can anyone take this language seriously</span>
0174    <span class="comment">% all(size(filt*scal) == [1,1]) &amp;&amp; filt*scal == 1</span>
0175    <span class="keyword">if</span> all(size(filt)==1) <span class="keyword">if</span> filt == 1; <span class="keyword">return</span>; <span class="keyword">end</span> ; <span class="keyword">end</span>
0176 
0177    [sz1,sz2,sz3,sz4] = size(rimg);
0178    <span class="keyword">for</span> j1 = 1:sz3; <span class="keyword">for</span> j2 = 1:sz4; 
0179       rsl = rimg(:,:,j1,j2);
0180 
0181       rna = isnan(rsl);
0182       rsl(rna) = 0;
0183       rsl = conv2(rsl, filt, <span class="string">'same'</span>);
0184       rsl(rna) = NaN;
0185 
0186       rimg(:,:,j1,j2) = rsl;
0187    <span class="keyword">end</span>; <span class="keyword">end</span>
0188 
0189 <a name="_sub6" href="#_subfunctions" class="code">function do_unit_test</a>
0190    img = <a href="../../../eidors/models/mk_image.html" class="code" title="function img= mk_image(mdl, elem_data, params, name)">mk_image</a>( <a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>(<span class="string">'a2c2'</span>,8));
0191    img.calc_colours.npoints = 8; 
0192 
0193    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(img);
0194    imt = NaN*ones(8); imt(3:6,2:7) = 1; imt(2:7,3:6) = 1; 
0195    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'cs 2d 1'</span>, imc, imt);
0196 
0197    imn = rmfield(img,<span class="string">'elem_data'</span>);
0198    imn.node_data = ones(size(imn.fwd_model.nodes,1),1);
0199    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(imn);
0200    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'cs 2d 2'</span>, imc, imt, 1e-14);
0201 
0202    img.elem_data(1:4) = 2;
0203    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(img);
0204    imt(3:6,3:6) = 1; imt(4:5,4:5) = 2; 
0205    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'cs 2d 3'</span>, imc, imt);
0206 
0207    imn.node_data(1:5) = 2;
0208    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(imn);
0209    imt(3:6,3:6) = 1; imt(4:5,3:6) = 1.049020821501088;
0210    imt(3:6,4:5) = 1.049020821501088; imt(4:5,4:5) = 2;
0211    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'cs 2d 4'</span>, imc, imt, 1e-14);
0212 
0213    imn.node_data(:) = 1; imn.node_data(1) = 4;
0214    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(imn);
0215    imt(3:6,3:6) = 1; imt(4:5,4:5) = 1.575633893074693; 
0216    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'cs 2d 5'</span>, imc, imt, 1e-14);
0217 
0218    imn.calc_colours.npoints = 7; 
0219    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(imn);
0220    imt = NaN*ones(7); imt(2:6,2:6) = 1; imt(4,1:7)= 1; imt(1:7,4)= 1;imt(4,4) = 4; 
0221    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'cs 2d 6'</span>, imc, imt, 1e-14);
0222 
0223 
0224 <span class="comment">% 3D Tests</span>
0225    img = <a href="../../../eidors/solvers/calc_jacobian_bkgnd.html" class="code" title="function img_bkgnd = calc_jacobian_bkgnd( inv_model )">calc_jacobian_bkgnd</a>( <a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>(<span class="string">'n3r2'</span>,[16,2]));
0226    img.calc_colours.npoints = 8; 
0227    imn = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(img,[inf,inf,1]);
0228 
0229    imt = NaN*ones(8); imt(3:6,2:7) = 1; imt(2:7,3:6) = 1; 
0230    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'cs 3d 1'</span>, imn, imt);
0231 
0232    imn = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(img,[inf,0,inf]);
0233    imt = NaN*ones(8); imt(1:8,3:6) = 1; 
0234    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'cs 3d 2'</span>, imn, imt);
0235 
0236    <span class="comment">% Should have no effect</span>
0237    img.fwd_model.nodes(:,3) = img.fwd_model.nodes(:,3)-1;
0238    imn = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(img,[inf,0,inf]); 
0239    imt = NaN*ones(8); imt(1:8,3:6) = 1; 
0240    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'cs 3d 3'</span>, imn, imt);
0241 
0242 
0243 <span class="comment">% multi image struct</span>
0244    img = <a href="../../../eidors/models/mk_image.html" class="code" title="function img= mk_image(mdl, elem_data, params, name)">mk_image</a>( <a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>(<span class="string">'a2c2'</span>,8));
0245    img.calc_colours.npoints = 8; 
0246    img(2) = img;
0247    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(img); 
0248    imt = NaN*ones(8); imt(3:6,2:7) = 1; imt(2:7,3:6) = 1; 
0249    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'cs mult 1'</span>, imc, cat(3,imt,imt));
0250 
0251    imgb = <a href="../../../eidors/models/mk_image.html" class="code" title="function img= mk_image(mdl, elem_data, params, name)">mk_image</a>( <a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>(<span class="string">'b2c2'</span>,8));
0252    imgb.calc_colours.npoints = 8; 
0253    img(3)=imgb;
0254    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(img); 
0255    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'cs mult 2'</span>, imc, cat(3,imt,imt,imt));
0256 
0257    imdl = <a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>(<span class="string">'c2t2'</span>,16);
0258    img = <a href="../../../eidors/models/mk_image.html" class="code" title="function img= mk_image(mdl, elem_data, params, name)">mk_image</a>(imdl,1);
0259    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(img);
0260    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'size e  1'</span>, size(imc), [64,64]);
0261 
0262    img.calc_colours.npoints = 40;
0263    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(img);
0264    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'size e  2'</span>, size(imc), [40,40]);
0265 
0266    img.fwd_model.mdl_slice_mapper.npx = 22;
0267    img.fwd_model.mdl_slice_mapper.npy = 32;
0268    img.fwd_model.mdl_slice_mapper.level = [inf,inf,0];
0269    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(img);
0270    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'size e  3'</span>, size(imc), [32,22]);
0271 
0272    img.fwd_model = rmfield(img.fwd_model,<span class="string">'mdl_slice_mapper'</span>);
0273    img.fwd_model.mdl_slice_mapper.x_pts = linspace(-150,150,20);
0274    img.fwd_model.mdl_slice_mapper.y_pts =-linspace(-150,150,23);
0275    img.fwd_model.mdl_slice_mapper.level = [inf,inf,0];
0276    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(img);
0277    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'size e  4'</span>, size(imc), [23,20]);
0278 
0279    img = rmfield(img,<span class="string">'elem_data'</span>);
0280    img.node_data =  ones(size(img.fwd_model.nodes,1),1);
0281    img.node_data =  (1:size(img.fwd_model.nodes,1))';
0282    img.fwd_model = rmfield(img.fwd_model,<span class="string">'mdl_slice_mapper'</span>);
0283    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(img);
0284    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'size n  1'</span>, size(imc), [40,40]);
0285 
0286    img.fwd_model.mdl_slice_mapper.x_pts = linspace(-150,150,20);
0287    img.fwd_model.mdl_slice_mapper.y_pts =-linspace(-150,150,23);
0288    img.fwd_model.mdl_slice_mapper.level = [inf,inf,0];
0289    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(img);
0290    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'size n  2'</span>, size(imc), [23,20]);</pre></div>
<hr><address>Generated on Tue 12-May-2015 16:08:56 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>